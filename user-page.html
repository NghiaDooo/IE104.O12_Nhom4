<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        /* Thêm CSS để tạo tab */

        article {
            display: none;
        }

        article.active {
            display: block;
        }
    </style>
    <link rel="stylesheet" href="./styles/user-page.css">
    <link rel="stylesheet" href="./styles/globals.css">
    <link rel="stylesheet" href="./styles/styleguide.css">
    <link rel="stylesheet" href="./styles/product.css">
</head>

<body>
    <div id="navbar"></div>
    <div class="user-container">
        <div class="user-box">
            <div class="box-left">
                <section>
                    <div onclick="showTab(Pages.USER_INFO, this)" class="tab-active">Hồ sơ</div>
                    <div onclick="showTab(Pages.PURCHASED_ORDER, this)">Lịch sử mua hàng</div>
                    <div onclick="logOut()">Log out</div>
                </section>
            </div>
            <div class="box-right">
                <article id="user-info" class="user-info article-active ">
                    1
                </article>
                <article id="purchased-order" class="purchased-order">
                    <h3>Lịch sử mua hàng</h3>
                    <div class="search-container">
                        <input id="search-purchased-product-text" type="text"
                            placeholder="Tìm kiếm sản phẩm bạn đã mua theo tên">
                        <img id="search-purchased-product-btn" src="./assets/images/user-page/search.svg" alt="search"
                            onclick="searchPurhasedProduct()">
                    </div>
                    <div class="purchased-products-container">
                        <div id="purchased-products" class="purchased-products">
                        </div>
                        <button id="btn-see-more" class="btn-see-more" onclick="loadMoreProduct()">Xem thêm</button>

                    </div>
                </article>
            </div>
        </div>
    </div>
    <div id="footer"></div>
    <script src="./js/navbar.js"></script>
    <script src="./js/footer.js"></script>
    <script src="./data/data.js"></script>
    <script src="./js/common.js"></script>
    <script>
        const Pages = {
            USER_INFO: 'user-info',
            PURCHASED_ORDER: 'purchased-order'
        };
        const purchasedProducts = data;
        var limitedProducts = 8;
        var productsData = purchasedProducts;

        function checkLoginState() {
            console.log(getCurrentUser());
            if (getCurrentUser() == null) {
                const parentContainer = document.querySelector('.user-container');
                const overlay = document.createElement('div');
                overlay.classList.add('overlay');
                parentContainer.appendChild(overlay);
                createPopup("Bạn chưa đăng nhập!", "Đăng nhập", () => window.location.href = "login-register.html", () => window.location.href = "home.html");
                return;
            };
        }

        function showTab(tabId, div) {
            document.querySelectorAll('.tab-active').forEach(function (div) {
                div.classList.remove('tab-active');
            });
            div.classList.add("tab-active");
            // Ẩn tất cả các tab
            document.querySelectorAll('article').forEach(function (article) {
                article.classList.remove('article-active');
            });

            // Hiển thị tab được chọn
            document.getElementById(tabId).classList.add('article-active');
        }

        function logOut() {
            setCurrentUser(null);
            window.location.href = "home.html"
        }

        function searchPurhasedProduct() {
            const searchKey = document.getElementById("search-purchased-product-text");
            if (searchKey.value == null) {
                document.getElementById("purchased-products").innerHTML = ''
                productsData = purchasedProducts;
                showLimitedProducts(productsData, document.getElementById("purchased-products"), limitedProducts);
                isShowedAllProducts();
                return;
            }
            document.getElementById("purchased-products").innerHTML = ''
            productsData = searchByNameLike(searchKey.value, purchasedProducts);
            if (productsData.length == 0)
                alert('Không tìm thấy sản phẩm!');
            showLimitedProducts(productsData, document.getElementById("purchased-products"), limitedProducts);
            isShowedAllProducts();
        };

        function isShowedAllProducts() {
            const btnSeeMore = document.getElementById("btn-see-more");
            console.log(btnSeeMore)
            if (limitedProducts >= productsData.length)
                btnSeeMore.style.display = 'none';
            else
                btnSeeMore.style.display = 'block';
        }

        function loadMoreProduct() {
            limitedProducts += 8;
            showLimitedProducts(data, document.getElementById("purchased-products"), limitedProducts);
            isShowedAllProducts();

        }
        window.onload = checkLoginState();
        document.addEventListener("DOMContentLoaded", () => {
            showLimitedProducts(data, document.getElementById("purchased-products"), limitedProducts);
            isShowedAllProducts();
        })

    </script>
</body>

</html>